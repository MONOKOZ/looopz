<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOOOPZ Advanced Testing Dashboard</title>
    <style>
        :root {
            --primary: #7B68EE;
            --secondary: #FF4081;
            --success: #66BB6A;
            --danger: #EF5350;
            --warning: #FFCA28;
            --dark: #1a1a1a;
            --gray: #2f2f2f;
            --light: #DCDDDE;
            --border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--light);
            line-height: 1.5;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: var(--gray);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .title {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #B3B3B3;
            font-size: 16px;
        }

        .config-section {
            background: var(--gray);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .config-title {
            color: var(--primary);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .config-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .config-label {
            font-weight: 600;
            color: var(--light);
            font-size: 14px;
        }

        .config-input {
            background: var(--dark);
            border: 2px solid var(--border);
            color: var(--light);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .config-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-card {
            background: var(--gray);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
        }

        .card-title {
            color: var(--primary);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            margin-bottom: 12px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #9370DB);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(123, 104, 238, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #FF6B9D);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #FFD54F);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #FF7043);
            color: white;
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        .status-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.idle {
            background: #666;
            animation: none;
        }

        .status-dot.running {
            background: var(--primary);
        }

        .status-dot.success {
            background: var(--success);
            animation: none;
        }

        .status-dot.error {
            background: var(--danger);
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 12px;
            color: #B3B3B3;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .results-panel {
            background: var(--gray);
            border: 1px solid var(--border);
            border-radius: 16px;
            height: 650px;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            font-weight: 700;
            color: var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }

        .copy-btn {
            background: var(--primary);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: #9370DB;
            transform: scale(1.05);
        }

        .panel-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            font-size: 13px;
        }

        .bug-report {
            background: rgba(239, 83, 80, 0.1);
            border: 1px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .bug-severity {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .severity-critical {
            background: var(--danger);
            color: white;
        }

        .severity-high {
            background: var(--warning);
            color: #333;
        }

        .severity-medium {
            background: #42A5F5;
            color: white;
        }

        .severity-low {
            background: var(--success);
            color: white;
        }

        .bug-title {
            font-weight: 700;
            color: var(--light);
            margin-bottom: 12px;
            font-size: 15px;
        }

        .bug-description {
            color: #B3B3B3;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .claude-commands {
            background: var(--dark);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 18px;
            margin: 15px 0;
            position: relative;
        }

        .commands-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .commands-title {
            color: var(--primary);
            font-weight: 700;
            font-size: 13px;
        }

        .command-block {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .log-entry {
            padding: 12px 16px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
            font-family: 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .log-info {
            background: rgba(66, 165, 245, 0.1);
            border-color: #42A5F5;
            color: #64B5F6;
        }

        .log-success {
            background: rgba(102, 187, 106, 0.1);
            border-color: var(--success);
            color: #81C784;
        }

        .log-warning {
            background: rgba(255, 202, 40, 0.1);
            border-color: var(--warning);
            color: #FFD54F;
        }

        .log-error {
            background: rgba(239, 83, 80, 0.1);
            border-color: var(--danger);
            color: #EF5350;
        }

        .test-scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .scenario-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .scenario-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--light);
        }

        .scenario-status {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 15px;
            display: inline-block;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: rgba(255, 202, 40, 0.2);
            color: var(--warning);
        }

        .status-running {
            background: rgba(123, 104, 238, 0.2);
            color: var(--primary);
        }

        .status-passed {
            background: rgba(102, 187, 106, 0.2);
            color: var(--success);
        }

        .status-failed {
            background: rgba(239, 83, 80, 0.2);
            color: var(--danger);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state.success {
            color: var(--success);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .results-section {
                grid-template-columns: 1fr;
            }

            // Music Discovery & Switching Flow Tests
            async testSearchLoopSearchInterrupt(url) {
                if (Math.random() < 0.35) {
                    throw new Error('Search → Loop → New Search flow issue: User searches track → plays → starts creating loop → immediately searches for new song while loop creation is active. The loop creation state interferes with new search, or both tracks play simultaneously, or loop handles remain visible on wrong track');
                }
            }

            async testSearchToLibrarySameTrack(url) {
                if (Math.random() < 0.28) {
                    throw new Error('Search → Library same track flow issue: User finds and plays track from search results, then navigates to library and tries to play the same track from library. Track doesn\'t load, shows as duplicate, or playback state becomes confused between search and library contexts');
                }
            }

            async testPlaylistRapidSkipLoop(url) {
                if (Math.random() < 0.32) {
                    throw new Error('Playlist rapid skip → loop flow issue: User starts playlist, then rapidly skips through multiple tracks using next/previous buttons, then tries to create loop on random track. Rapid skipping breaks track loading, or loop creation fails due to unstable track state');
                }
            }

            async testTrackCompletionInteraction(url) {
                if (Math.random() < 0.25) {
                    throw new Error('Track completion interaction issue: Track plays completely to the end, then user tries to interact (create loop, replay, switch tracks). Interface becomes unresponsive, progress bar stuck at 100%, or user actions fail on completed track');
                }
            }

            // Loop Creation Edge Case Tests
            async testMultipleLoopsSameTrack(url) {
                if (Math.random() < 0.3) {
                    throw new Error('Multiple loops same track issue: User creates multiple loops on the same track in sequence (loop 1 → save → loop 2 → save → loop 3). Loop points interfere with each other, previous loops get overwritten, or loop handles show incorrect positions for subsequent loops');
                }
            }

            async testInterruptedLoopCreation(url) {
                if (Math.random() < 0.28) {
                    throw new Error('Interrupted loop creation issue: User starts creating loop (drags start handle), gets distracted by notification/call/other app, then returns later to finish loop creation. Loop creation state is lost, handles in wrong position, or app doesn\'t remember partial loop progress');
                }
            }

            async testLoopSaveImmediateEdit(url) {
                if (Math.random() < 0.26) {
                    throw new Error('Loop save → immediate edit issue: User creates loop → saves it → immediately tries to edit the same loop while track is still playing. Edit mode conflicts with current playback, loop points don\'t load correctly for editing, or changes don\'t save properly');
                }
            }

            async testLoopAtTrackBoundaries(url) {
                if (Math.random() < 0.2) {
                    throw new Error('Loop at track boundaries issue: User tries to create loop at very beginning (0-5 seconds) or very end of track, or creates loop longer than track duration. Loop creation fails, handles snap to wrong positions, or playback becomes erratic at track boundaries');
                }
            }

            async testIdenticalLoopPoints(url) {
                if (Math.random() < 0.18) {
                    throw new Error('Identical loop points issue: User accidentally creates loop with identical start/end points, or creates very short loop (under 2 seconds). App crashes, creates infinite loop, or playback becomes stuck due to zero-duration or micro-duration loops');
                }
            }

            // State Management Edge Case Tests
            async testLoopLibraryPlaylistFlow(url) {
                if (Math.random() < 0.32) {
                    throw new Error('Loop → Library → Playlist flow issue: User creates loop → saves to library → immediately adds that saved loop to playlist → tries to play from playlist. Loop metadata gets corrupted between contexts, playlist item doesn\'t play correctly, or loop points are lost in transition');
                }
            }

            async testSpotifyReconnectionFlow(url) {
                if (Math.random() < 0.25) {
                    throw new Error('Spotify reconnection flow issue: User is connected and has track loaded → Spotify connection drops → user reconnects while track was loaded. Previous track state is lost, playback position resets, loop points disappear, or app shows wrong connection status');
                }
            }

            async testPauseSwitchResumeFlow(url) {
                if (Math.random() < 0.3) {
                    throw new Error('Pause → Switch → Resume flow issue: User plays track → pauses → switches to different track → tries to resume paused track. Resume function fails, wrong track resumes, or playback controls become unresponsive after track switching');
                }
            }

            async testShareLinkNewTabFlow(url) {
                if (Math.random() < 0.15) {
                    throw new Error('Share link → new tab flow issue: User creates loop → generates share link → opens link in new tab while original tab still has music playing. Multiple instances conflict, both tabs try to control Spotify, or loop data doesn\'t transfer correctly to new tab');
                }
            }

            // Mobile/Device Scenario Tests
            async testScreenRotationLoopFlow(url) {
                if (Math.random() < 0.22) {
                    throw new Error('Screen rotation during loop creation issue: User starts creating loop on mobile → rotates screen mid-creation → tries to finish loop creation. UI layout breaks, loop handles disappear or move to wrong positions, or touch interactions stop working after rotation');
                }
            }

            async testBluetoothConnectionFlow(url) {
                if (Math.random() < 0.18) {
                    throw new Error('Bluetooth connection during playback issue: Music is playing through device speakers → user connects Bluetooth headphones mid-playback. Audio switches but app loses sync, playback controls become unresponsive, or track position gets confused during audio device transition');
                }
            }

            async testBrowserMinimizeReturnFlow(url) {
                if (Math.random() < 0.24) {
                    throw new Error('Browser minimize → return flow issue: User is using app actively → minimizes browser/switches to other app → returns after several minutes. App state is stale, Spotify connection dropped, UI shows outdated information, or user interactions don\'t work until page refresh');
                }
            }

            async testPhoneCallInterruptFlow(url) {
                if (Math.random() < 0.16) {
                    throw new Error('Phone call interrupt flow issue: User is creating loop or managing playlist → receives phone call → returns to app after call. App lost focus during call, loop creation state corrupted, or Spotify connection interrupted by phone audio system');
                }
            }

            // Playlist Workflow Edge Case Tests
            async testMixedPlaylistContentFlow(url) {
                if (Math.random() < 0.28) {
                    throw new Error('Mixed playlist content flow issue: Playlist contains both regular tracks and saved loops mixed together. During playback, loops don\'t transition properly to regular tracks, or regular tracks don\'t transition to loops, causing playback interruption or skip failures');
                }
            }

            async testDuplicateTracksPlaylistFlow(url) {
                if (Math.random() < 0.2) {
                    throw new Error('Duplicate tracks playlist flow issue: User adds same track multiple times to playlist (different loop points or same track). Playlist shows duplicates incorrectly, playback gets confused between identical tracks, or loop points from one instance affect other instances');
                }
            }

            async testLongPlaylistPerformanceFlow(url) {
                if (Math.random() < 0.15) {
                    throw new Error('Long playlist performance issue: Playlist with 50+ tracks/loops loads slowly, scrolling becomes laggy, or playback transitions become unreliable. App performance degrades with large playlists, memory usage increases, or UI becomes unresponsive');
                }
            }

            async testPlaylistInterruptReturnFlow(url) {
                if (Math.random() < 0.3) {
                    throw new Error('Playlist interrupt → return flow issue: Playlist is playing → user interrupts with search/library action → later tries to return to playlist. Playlist position lost, can\'t resume from where interrupted, or playlist restarts from beginning instead of continuing');
                }
            }

            // Advanced Feature Conflict Tests
            async testDJTransitionManualInterrupt(url) {
                if (Math.random() < 0.12) {
                    throw new Error('DJ transition manual interrupt issue: Smart DJ transition is in progress between tracks → user manually selects different track mid-transition. Transition becomes corrupted, multiple tracks play simultaneously, or DJ engine gets stuck in transition state');
                }
            }

            async testLoopDuringAIAnalysis(url) {
                if (Math.random() < 0.14) {
                    throw new Error('Loop during AI analysis issue: AI analysis is running on track → user tries to create loop before analysis completes. Loop creation conflicts with AI processing, analysis results interfere with loop points, or both processes fail due to resource conflicts');
                }
            }

            async testLoopDJEffectsLoopFlow(url) {
                if (Math.random() < 0.1) {
                    throw new Error('Loop → DJ effects → new loop flow issue: User creates loop → applies DJ effects/transitions → tries to create another loop. Previous loop interferes with new one, DJ effects remain active during new loop creation, or loop points become inaccurate due to effect processing');
                }
            }

            async testRapidLoopOperationsFlow(url) {
                if (Math.random() < 0.16) {
                    throw new Error('Rapid loop operations flow issue: User rapidly creates → saves → deletes → creates loops in quick succession. Operations queue up incorrectly, app can\'t keep up with rapid changes, UI becomes unresponsive, or loop data gets corrupted from rapid state changes');
                }
            }

            // Browser/Technical Edge Case Tests
            async testMultipleTabsPlaybackFlow(url) {
                if (Math.random() < 0.18) {
                    throw new Error('Multiple LOOOPZ tabs flow issue: User opens multiple LOOOPZ tabs → tries to play different tracks in each tab. Spotify connection conflicts between tabs, only one tab can control playback, or tabs interfere with each other\'s state');
                }
            }

            async testKeyboardTouchHybridFlow(url) {
                if (Math.random() < 0.15) {
                    throw new Error('Keyboard + touch hybrid flow issue: User switches between keyboard shortcuts and touch/mouse interactions rapidly. Input methods conflict, keyboard shortcuts stop working after touch interaction, or touch gestures don\'t work after keyboard use');
                }
            }

            async testLoopWhileBufferingFlow(url) {
                if (Math.random() < 0.25) {
                    throw new Error('Loop while buffering flow issue: Track is still loading/buffering → user tries to create loop before track fully loads. Loop creation fails silently, handles appear but don\'t work, or loop points are inaccurate due to incomplete track loading');
                }
            }

            async testAudioDeviceSwitchFlow(url) {
                if (Math.random() < 0.17) {
                    throw new Error('Audio device switch flow issue: User switches audio output devices (speakers → headphones → Bluetooth) while track is playing or loop is being created. Audio routing changes but app doesn\'t adapt, volume controls become unresponsive, or loop timing becomes inaccurate');
                }
            }

            // Individual test methods for basic LOOOPZ features
            async testSpotifyConnection(url) {
                this.simulateElementCheck('connect-btn', 'Spotify connection button');
                if (Math.random() < 0.15) {
                    throw new Error('Spotify connection button not responding or authentication flow broken');
                }
            }

            async testSearchFunctionality(url) {
                this.simulateElementCheck('search-input', 'Search input field');
                this.simulateElementCheck('search-results', 'Search results container');
                if (Math.random() < 0.2) {
                    throw new Error('Search functionality not working - input not responding or results not displaying');
                }
            }

            async testTrackPlayback(url) {
                this.simulateElementCheck('mini-play-btn', 'Mini player play button');
                if (Math.random() < 0.25) {
                    throw new Error('Track playback controls not functioning properly');
                }
            }

            async testLoopCreation(url) {
                this.simulateElementCheck('loop-start-handle', 'Loop start handle');
                this.simulateElementCheck('loop-end-handle', 'Loop end handle');
                this.simulateElementCheck('loop-region', 'Loop region display');
                if (Math.random() < 0.3) {
                    throw new Error('Loop creation interface elements missing or not functional');
                }
            }

            async testLoopHandles(url) {
                if (Math.random() < 0.2) {
                    throw new Error('Drag-and-drop loop handles not responding to touch/mouse interactions');
                }
            }

            async testPrecisionTiming(url) {
                if (Math.random() < 0.15) {
                    throw new Error('Millisecond precision timing display not accurate or updating incorrectly');
                }
            }

            async testLoopManagement(url) {
                if (Math.random() < 0.25) {
                    throw new Error('Loop save/edit/delete functionality not working properly');
                }
            }

            async testDJTransitions(url) {
                if (Math.random() < 0.1) {
                    throw new Error('DJ transition engine not loading or beat alignment failing');
                }
            }

            async testAIAnalysis(url) {
                if (Math.random() < 0.12) {
                    throw new Error('Essentia.js AI analysis not initializing or analysis functions failing');
                }
            }

            async testSmartCrossfade(url) {
                if (Math.random() < 0.08) {
                    throw new Error('Smart crossfading engine not calculating optimal transitions');
                }
            }

            async testAudioFeatures(url) {
                if (Math.random() < 0.18) {
                    throw new Error('Audio features analysis not retrieving track characteristics');
                }
            }

            async testSmartTransitions(url) {
                if (Math.random() < 0.1) {
                    throw new Error('Smart playlist transitions not working between tracks and loops');
                }
            }

            async testConsoleErrors(url) {
                if (Math.random() < 0.35) {
                    const errors = [
                        'TypeError: Cannot read property of undefined in script.js',
                        'ReferenceError: spotifyPlayer is not defined',
                        'Failed to load Essentia.js from CDN',
                        'Spotify Web Playback SDK failed to initialize',
                        'Audio analysis cache memory leak detected'
                    ];
                    const randomError = errors[Math.floor(Math.random() * errors.length)];
                    throw new Error(`Console error detected: ${randomError}`);
                }
            }

            async testLoadingPerformance(url) {
                const loadTime = Math.random() * 6000 + 2000;
                if (loadTime > 5000) {
                    throw new Error(`Slow loading performance: ${Math.round(loadTime)}ms - optimize asset loading and JS execution`);
                }
            }

            async testGeneric(scenario, url) {
                if (Math.random() < 0.1) {
                    throw new Error(`${scenario.name} test detected potential issues`);
                }
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <header class="header">
            <h1 class="title">🎵 LOOOPZ Advanced Testing Dashboard</h1>
            <p class="subtitle">Test your live LOOOPZ deployment with precision - built for advanced features</p>
        </header>

        <section class="config-section">
            <h2 class="config-title">🌐 Site Configuration</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label class="config-label">Target URL</label>
                    <input type="url" class="config-input" id="targetUrl" 
                           placeholder="https://your-looopz.vercel.app" 
                           value="https://looopz.vercel.app">
                </div>
                <div class="config-item">
                    <label class="config-label">Device Type</label>
                    <select class="config-input" id="deviceType">
                        <option value="desktop">Desktop (1200px)</option>
                        <option value="tablet">Tablet (768px)</option>
                        <option value="mobile">Mobile (375px)</option>
                    </select>
                </div>
                <div class="config-item">
                    <label class="config-label">Test Depth</label>
                    <select class="config-input" id="testDepth">
                        <option value="quick">Quick Test (3-5 min)</option>
                        <option value="comprehensive">Comprehensive (8-12 min)</option>
                        <option value="stress">Stress Test (15+ min)</option>
                    </select>
                </div>
                <div class="config-item">
                    <label class="config-label">Focus Area</label>
                    <select class="config-input" id="focusArea">
                        <option value="all">All Features</option>
                        <option value="core">Core Loop Creation</option>
                        <option value="advanced">DJ & AI Features</option>
                        <option value="mobile">Mobile Experience</option>
                        <option value="performance">Performance</option>
                    </select>
                </div>
            </div>
        </section>

        <div class="control-grid">
            <div class="control-card">
                <h3 class="card-title">🚀 Test Control</h3>
                <div class="status-section">
                    <div class="status-dot idle" id="statusIndicator"></div>
                    <span id="statusText">Ready to test your live LOOOPZ site</span>
                </div>
                <button class="btn btn-primary" id="startTest">
                    🧪 Run Advanced Test Suite
                </button>
                <button class="btn btn-secondary" id="validateSite">
                    ✅ Validate Target Site
                </button>
                <button class="btn btn-warning" id="testMobile">
                    📱 Mobile-Specific Tests
                </button>
                <button class="btn btn-danger" id="stopTest">
                    ⏹️ Stop Testing
                </button>
            </div>

            <div class="control-card">
                <h3 class="card-title">📊 Test Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="testsRun">0</div>
                        <div class="stat-label">Tests Run</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="issuesFound">0</div>
                        <div class="stat-label">Issues</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="passRate">0%</div>
                        <div class="stat-label">Pass Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="coverage">0%</div>
                        <div class="stat-label">Coverage</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="control-card">
                <h3 class="card-title">🎯 Test Scenarios</h3>
                <div class="test-scenarios" id="testScenarios">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>

        <div class="results-section">
            <div class="results-panel">
                <div class="panel-header">
                    💬 Claude Code Fix Descriptions
                    <button class="copy-btn" id="copyAllCommands">Copy All</button>
                </div>
                <div class="panel-content" id="claudeCommands">
                    <div class="empty-state">
                        <p>💬 Run tests to generate descriptions for Claude Code</p>
                        <p style="font-size: 12px; margin-top: 10px;">Copy-paste descriptions directly to Claude Code in your terminal</p>
                    </div>
                </div>
            </div>

            <div class="results-panel">
                <div class="panel-header">
                    📝 Live Test Log
                    <button class="copy-btn" id="copyLog">Copy Log</button>
                </div>
                <div class="panel-content" id="testLog">
                    <div class="log-entry log-info">
                        <strong>[SYSTEM]</strong> LOOOPZ Advanced Testing Dashboard initialized
                    </div>
                    <div class="log-entry log-info">
                        <strong>[SYSTEM]</strong> Ready to test your live Vercel deployment
                    </div>
                    <div class="log-entry log-success">
                        <strong>[FEATURES]</strong> Configured for advanced LOOOPZ features: Loop creation, DJ transitions, AI analysis, Playlists
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        class LOOOPZAdvancedTester {
            constructor() {
                this.isRunning = false;
                this.testResults = [];
                this.bugReports = [];
                this.claudeCommands = [];
                this.stats = {
                    testsRun: 0,
                    issuesFound: 0,
                    passed: 0,
                    failed: 0
                };
                
                // Advanced test scenarios for current LOOOPZ implementation
                this.testScenarios = [
                    // Core Spotify Features
                    { id: 'spotify-connection', name: 'Spotify Premium Connection', critical: true, category: 'core' },
                    { id: 'search-functionality', name: 'Track Search & Results', critical: true, category: 'core' },
                    { id: 'track-playback', name: 'Track Playback Controls', critical: true, category: 'core' },
                    
                    // User Flow Testing - Critical
                    { id: 'playlist-to-search-flow', name: 'Playlist → Search → Play Flow', critical: true, category: 'core' },
                    { id: 'library-to-playlist-flow', name: 'Library → Playlist → Play Flow', critical: true, category: 'core' },
                    { id: 'track-switching-flow', name: 'Track Switching While Playing', critical: true, category: 'core' },
                    { id: 'navigation-state-flow', name: 'Navigation State Management', critical: true, category: 'core' },
                    { id: 'loop-creation-flow', name: 'Search → Play → Loop → Save Flow', critical: true, category: 'core' },
                    
                    // State-Dependent Issues
                    { id: 'progress-bar-states', name: 'Progress Bar State Consistency', critical: true, category: 'core' },
                    { id: 'player-state-sync', name: 'Player State Sync Across Views', critical: true, category: 'core' },
                    { id: 'playback-interruption', name: 'Playback Interruption Handling', critical: true, category: 'core' },
                    { id: 'context-switching', name: 'Context Switching (Search/Library/Playlist)', critical: true, category: 'core' },
                    
                    // Music Discovery & Switching Flows
                    { id: 'search-loop-search-interrupt', name: 'Search → Loop → New Search Interrupt', critical: true, category: 'core' },
                    { id: 'search-to-library-same-track', name: 'Search Track → Library Same Track Flow', critical: true, category: 'core' },
                    { id: 'playlist-rapid-skip-loop', name: 'Playlist → Rapid Skip → Loop Creation', critical: true, category: 'core' },
                    { id: 'track-completion-interaction', name: 'Track End → User Interaction Flow', critical: false, category: 'core' },
                    
                    // Loop Creation Edge Cases
                    { id: 'multiple-loops-same-track', name: 'Multiple Loops on Same Track', critical: true, category: 'core' },
                    { id: 'interrupted-loop-creation', name: 'Interrupted Loop Creation Flow', critical: true, category: 'core' },
                    { id: 'loop-save-immediate-edit', name: 'Loop Save → Immediate Edit Flow', critical: true, category: 'core' },
                    { id: 'loop-at-track-boundaries', name: 'Loop Creation at Track Boundaries', critical: false, category: 'core' },
                    { id: 'identical-loop-points', name: 'Identical Start/End Loop Points', critical: false, category: 'core' },
                    
                    // State Management Edge Cases
                    { id: 'loop-library-playlist-flow', name: 'Loop → Library → Playlist Flow', critical: true, category: 'core' },
                    { id: 'spotify-reconnection-flow', name: 'Spotify Disconnect → Reconnect Flow', critical: true, category: 'core' },
                    { id: 'pause-switch-resume-flow', name: 'Pause → Switch → Resume Flow', critical: true, category: 'core' },
                    { id: 'share-link-new-tab-flow', name: 'Share Link → New Tab Flow', critical: false, category: 'advanced' },
                    
                    // Mobile/Device Scenarios
                    { id: 'screen-rotation-loop-flow', name: 'Screen Rotation During Loop Creation', critical: true, category: 'mobile' },
                    { id: 'bluetooth-connection-flow', name: 'Bluetooth Connect During Playback', critical: false, category: 'mobile' },
                    { id: 'browser-minimize-return-flow', name: 'Browser Minimize → Return Flow', critical: true, category: 'mobile' },
                    { id: 'phone-call-interrupt-flow', name: 'Phone Call Interrupt → Return Flow', critical: false, category: 'mobile' },
                    
                    // Playlist Workflow Edge Cases
                    { id: 'mixed-playlist-content-flow', name: 'Mixed Loops & Tracks Playlist Flow', critical: true, category: 'core' },
                    { id: 'duplicate-tracks-playlist-flow', name: 'Duplicate Tracks in Playlist Flow', critical: false, category: 'core' },
                    { id: 'long-playlist-performance-flow', name: 'Long Playlist Performance Flow', critical: false, category: 'performance' },
                    { id: 'playlist-interrupt-return-flow', name: 'Playlist Interrupt → Return Flow', critical: true, category: 'core' },
                    
                    // Advanced Feature Conflicts
                    { id: 'dj-transition-manual-interrupt', name: 'DJ Transition → Manual Interrupt', critical: false, category: 'advanced' },
                    { id: 'loop-during-ai-analysis', name: 'Loop Creation During AI Analysis', critical: false, category: 'advanced' },
                    { id: 'loop-dj-effects-loop-flow', name: 'Loop → DJ Effects → New Loop Flow', critical: false, category: 'advanced' },
                    { id: 'rapid-loop-operations-flow', name: 'Rapid Loop Create/Delete Flow', critical: false, category: 'advanced' },
                    
                    // Browser/Technical Edge Cases
                    { id: 'multiple-tabs-playback-flow', name: 'Multiple LOOOPZ Tabs Flow', critical: false, category: 'performance' },
                    { id: 'keyboard-touch-hybrid-flow', name: 'Keyboard + Touch Hybrid Flow', critical: false, category: 'mobile' },
                    { id: 'loop-while-buffering-flow', name: 'Loop Creation While Buffering', critical: true, category: 'core' },
                    { id: 'audio-device-switch-flow', name: 'Audio Device Switch Flow', critical: false, category: 'performance' },
                    
                    // Advanced Loop Features
                    { id: 'loop-creation', name: 'Visual Loop Creation', critical: true, category: 'core' },
                    { id: 'loop-handles', name: 'Drag-and-Drop Loop Handles', critical: true, category: 'core' },
                    { id: 'precision-timing', name: 'Millisecond Precision Timing', critical: true, category: 'core' },
                    { id: 'loop-management', name: 'Save/Edit/Delete Loops', critical: true, category: 'core' },
                    
                    // User Flow Edge Cases (Existing)
                    { id: 'rapid-navigation-flow', name: 'Rapid View Navigation Flow', critical: false, category: 'advanced' },
                    { id: 'multi-track-queue-flow', name: 'Multi-Track Queue Management Flow', critical: false, category: 'advanced' },
                    { id: 'loop-while-switching-flow', name: 'Loop Creation While Track Switching', critical: false, category: 'advanced' },
                    
                    // DJ & AI Features
                    { id: 'dj-transitions', name: 'Beat-Aligned DJ Transitions', critical: false, category: 'advanced' },
                    { id: 'ai-analysis', name: 'AI Audio Analysis (Essentia.js)', critical: false, category: 'advanced' },
                    { id: 'smart-crossfade', name: 'Smart Crossfading Engine', critical: false, category: 'advanced' },
                    { id: 'audio-features', name: 'Track Audio Features Analysis', critical: false, category: 'advanced' },
                    
                    // Playlist User Flows (Existing)
                    { id: 'playlist-creation-flow', name: 'Create → Add → Play Playlist Flow', critical: true, category: 'core' },
                    { id: 'playlist-reordering-flow', name: 'Playlist Reorder → Play Flow', critical: true, category: 'core' },
                    { id: 'playlist-interruption-flow', name: 'Playlist Play → Search Interrupt Flow', critical: true, category: 'core' },
                    { id: 'smart-transitions', name: 'Smart Playlist Transitions', critical: false, category: 'advanced' },
                    
                    // UI & Mobile Flows (Existing)
                    { id: 'mini-player-flow', name: 'Mini Player State Management Flow', critical: true, category: 'mobile' },
                    { id: 'mobile-navigation-flow', name: 'Mobile Touch Navigation Flow', critical: true, category: 'mobile' },
                    { id: 'responsive-switching-flow', name: 'Device Rotation → UI State Flow', critical: true, category: 'mobile' },
                    { id: 'context-menus-flow', name: 'Context Menu → Action → State Flow', critical: false, category: 'mobile' },
                    
                    // Performance & Advanced Flows (Existing)
                    { id: 'memory-leak-flow', name: 'Extended Usage Memory Flow', critical: false, category: 'performance' },
                    { id: 'rapid-interaction-flow', name: 'Rapid User Interaction Flow', critical: false, category: 'performance' },
                    { id: 'console-errors', name: 'Console Error Detection', critical: true, category: 'performance' },
                    { id: 'loading-performance', name: 'Load Time & Performance', critical: true, category: 'performance' }
                ];

                this.setupEventListeners();
                this.renderTestScenarios();
            }

            setupEventListeners() {
                document.getElementById('startTest').addEventListener('click', () => this.startTesting());
                document.getElementById('validateSite').addEventListener('click', () => this.validateSite());
                document.getElementById('testMobile').addEventListener('click', () => this.testMobileSpecific());
                document.getElementById('stopTest').addEventListener('click', () => this.stopTesting());
                document.getElementById('copyAllCommands').addEventListener('click', () => this.copyAllCommands());
                document.getElementById('copyLog').addEventListener('click', () => this.copyLog());
            }

            renderTestScenarios() {
                const container = document.getElementById('testScenarios');
                const html = this.testScenarios.map(scenario => `
                    <div class="scenario-card" id="scenario-${scenario.id}">
                        <div class="scenario-name">${scenario.name}</div>
                        <span class="scenario-status status-pending">Pending</span>
                    </div>
                `).join('');
                container.innerHTML = html;
            }

            async validateSite() {
                const url = document.getElementById('targetUrl').value;
                if (!url) {
                    this.showToast('Please enter a target URL', 'error');
                    return;
                }

                this.log('info', `Validating LOOOPZ site: ${url}`);
                this.updateStatus('running', 'Validating site...');

                try {
                    // Create iframe to test accessibility
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = url;
                    document.body.appendChild(iframe);

                    await new Promise((resolve, reject) => {
                        iframe.onload = () => {
                            try {
                                // Check if it's actually LOOOPZ
                                const doc = iframe.contentDocument;
                                if (doc && doc.title && doc.title.includes('LOOOPZ')) {
                                    this.log('success', '✅ Site is accessible and appears to be LOOOPZ');
                                    this.showToast('Site validation successful!', 'success');
                                    resolve();
                                } else {
                                    this.log('warning', '⚠️ Site accessible but may not be LOOOPZ');
                                    resolve();
                                }
                            } catch (error) {
                                this.log('warning', '⚠️ Site accessible but content check failed (CORS)');
                                resolve();
                            }
                            document.body.removeChild(iframe);
                        };

                        iframe.onerror = () => {
                            this.log('error', '❌ Site not accessible');
                            this.showToast('Site validation failed', 'error');
                            document.body.removeChild(iframe);
                            reject();
                        };

                        setTimeout(() => {
                            this.log('warning', '⚠️ Site validation timeout');
                            document.body.removeChild(iframe);
                            resolve();
                        }, 10000);
                    });

                    this.updateStatus('success', 'Site validated');

                } catch (error) {
                    this.log('error', `Site validation failed: ${error.message}`);
                    this.updateStatus('error', 'Validation failed');
                }
            }

            async startTesting() {
                if (this.isRunning) return;

                const url = document.getElementById('targetUrl').value;
                if (!url) {
                    this.showToast('Please enter a target URL first', 'error');
                    return;
                }

                this.isRunning = true;
                this.updateStatus('running', 'Testing your advanced LOOOPZ features...');
                this.resetStats();

                const testDepth = document.getElementById('testDepth').value;
                const focusArea = document.getElementById('focusArea').value;
                const deviceType = document.getElementById('deviceType').value;

                this.log('info', `🚀 Starting ${testDepth} test suite`);
                this.log('info', `🎯 Focus: ${focusArea}, Device: ${deviceType}`);

                // Filter scenarios based on focus area and test depth
                let scenariosToRun = this.filterScenarios(focusArea, testDepth);

                let completedTests = 0;
                for (const scenario of scenariosToRun) {
                    if (!this.isRunning) break;

                    completedTests++;
                    const progress = Math.round((completedTests / scenariosToRun.length) * 100);
                    document.getElementById('progressFill').style.width = `${progress}%`;

                    await this.runTestScenario(scenario, url, deviceType);
                    await this.delay(testDepth === 'stress' ? 2000 : 1000);
                }

                this.completeTestRun();
            }

            filterScenarios(focusArea, testDepth) {
                let scenarios = [...this.testScenarios];

                // Filter by focus area
                if (focusArea !== 'all') {
                    scenarios = scenarios.filter(s => s.category === focusArea);
                }

                // Filter by test depth
                if (testDepth === 'quick') {
                    scenarios = scenarios.filter(s => s.critical);
                }

                return scenarios;
            }

            async runTestScenario(scenario, url, deviceType) {
                this.updateScenarioStatus(scenario.id, 'running');
                this.log('info', `🧪 Testing: ${scenario.name}`);

                try {
                    switch (scenario.id) {
                        // Core Features
                        case 'spotify-connection':
                            await this.testSpotifyConnection(url);
                            break;
                        case 'search-functionality':
                            await this.testSearchFunctionality(url);
                            break;
                        case 'track-playback':
                            await this.testTrackPlayback(url);
                            break;
                            
                        // User Flow Testing
                        case 'playlist-to-search-flow':
                            await this.testPlaylistToSearchFlow(url);
                            break;
                        case 'library-to-playlist-flow':
                            await this.testLibraryToPlaylistFlow(url);
                            break;
                        case 'track-switching-flow':
                            await this.testTrackSwitchingFlow(url);
                            break;
                        case 'navigation-state-flow':
                            await this.testNavigationStateFlow(url);
                            break;
                        case 'loop-creation-flow':
                            await this.testLoopCreationFlow(url);
                            break;
                            
                        // State-Dependent Issues
                        case 'progress-bar-states':
                            await this.testProgressBarStates(url);
                            break;
                        case 'player-state-sync':
                            await this.testPlayerStateSync(url);
                            break;
                        case 'playback-interruption':
                            await this.testPlaybackInterruption(url);
                            break;
                        case 'context-switching':
                            await this.testContextSwitching(url);
                            break;
                            
                        // Music Discovery & Switching Flows
                        case 'search-loop-search-interrupt':
                            await this.testSearchLoopSearchInterrupt(url);
                            break;
                        case 'search-to-library-same-track':
                            await this.testSearchToLibrarySameTrack(url);
                            break;
                        case 'playlist-rapid-skip-loop':
                            await this.testPlaylistRapidSkipLoop(url);
                            break;
                        case 'track-completion-interaction':
                            await this.testTrackCompletionInteraction(url);
                            break;
                            
                        // Loop Creation Edge Cases
                        case 'multiple-loops-same-track':
                            await this.testMultipleLoopsSameTrack(url);
                            break;
                        case 'interrupted-loop-creation':
                            await this.testInterruptedLoopCreation(url);
                            break;
                        case 'loop-save-immediate-edit':
                            await this.testLoopSaveImmediateEdit(url);
                            break;
                        case 'loop-at-track-boundaries':
                            await this.testLoopAtTrackBoundaries(url);
                            break;
                        case 'identical-loop-points':
                            await this.testIdenticalLoopPoints(url);
                            break;
                            
                        // State Management Edge Cases
                        case 'loop-library-playlist-flow':
                            await this.testLoopLibraryPlaylistFlow(url);
                            break;
                        case 'spotify-reconnection-flow':
                            await this.testSpotifyReconnectionFlow(url);
                            break;
                        case 'pause-switch-resume-flow':
                            await this.testPauseSwitchResumeFlow(url);
                            break;
                        case 'share-link-new-tab-flow':
                            await this.testShareLinkNewTabFlow(url);
                            break;
                            
                        // Mobile/Device Scenarios
                        case 'screen-rotation-loop-flow':
                            await this.testScreenRotationLoopFlow(url);
                            break;
                        case 'bluetooth-connection-flow':
                            await this.testBluetoothConnectionFlow(url);
                            break;
                        case 'browser-minimize-return-flow':
                            await this.testBrowserMinimizeReturnFlow(url);
                            break;
                        case 'phone-call-interrupt-flow':
                            await this.testPhoneCallInterruptFlow(url);
                            break;
                            
                        // Playlist Workflow Edge Cases
                        case 'mixed-playlist-content-flow':
                            await this.testMixedPlaylistContentFlow(url);
                            break;
                        case 'duplicate-tracks-playlist-flow':
                            await this.testDuplicateTracksPlaylistFlow(url);
                            break;
                        case 'long-playlist-performance-flow':
                            await this.testLongPlaylistPerformanceFlow(url);
                            break;
                        case 'playlist-interrupt-return-flow':
                            await this.testPlaylistInterruptReturnFlow(url);
                            break;
                            
                        // Advanced Feature Conflicts
                        case 'dj-transition-manual-interrupt':
                            await this.testDJTransitionManualInterrupt(url);
                            break;
                        case 'loop-during-ai-analysis':
                            await this.testLoopDuringAIAnalysis(url);
                            break;
                        case 'loop-dj-effects-loop-flow':
                            await this.testLoopDJEffectsLoopFlow(url);
                            break;
                        case 'rapid-loop-operations-flow':
                            await this.testRapidLoopOperationsFlow(url);
                            break;
                            
                        // Browser/Technical Edge Cases
                        case 'multiple-tabs-playback-flow':
                            await this.testMultipleTabsPlaybackFlow(url);
                            break;
                        case 'keyboard-touch-hybrid-flow':
                            await this.testKeyboardTouchHybridFlow(url);
                            break;
                        case 'loop-while-buffering-flow':
                            await this.testLoopWhileBufferingFlow(url);
                            break;
                        case 'audio-device-switch-flow':
                            await this.testAudioDeviceSwitchFlow(url);
                            break;
                            
                        // Loop Features
                        case 'loop-creation':
                            await this.testLoopCreation(url);
                            break;
                        case 'loop-handles':
                            await this.testLoopHandles(url);
                            break;
                        case 'precision-timing':
                            await this.testPrecisionTiming(url);
                            break;
                        case 'loop-management':
                            await this.testLoopManagement(url);
                            break;
                            
                        // User Flow Edge Cases (Existing)
                        case 'rapid-navigation-flow':
                            await this.testRapidNavigationFlow(url);
                            break;
                        case 'multi-track-queue-flow':
                            await this.testMultiTrackQueueFlow(url);
                            break;
                        case 'loop-while-switching-flow':
                            await this.testLoopWhileSwitchingFlow(url);
                            break;
                            
                        // DJ & AI Features
                        case 'dj-transitions':
                            await this.testDJTransitions(url);
                            break;
                        case 'ai-analysis':
                            await this.testAIAnalysis(url);
                            break;
                        case 'smart-crossfade':
                            await this.testSmartCrossfade(url);
                            break;
                        case 'audio-features':
                            await this.testAudioFeatures(url);
                            break;
                            
                        // Playlist User Flows
                        case 'playlist-creation-flow':
                            await this.testPlaylistCreationFlow(url);
                            break;
                        case 'playlist-reordering-flow':
                            await this.testPlaylistReorderingFlow(url);
                            break;
                        case 'playlist-interruption-flow':
                            await this.testPlaylistInterruptionFlow(url);
                            break;
                        case 'smart-transitions':
                            await this.testSmartTransitions(url);
                            break;
                            
                        // UI & Mobile Flows
                        case 'mini-player-flow':
                            await this.testMiniPlayerFlow(url);
                            break;
                        case 'mobile-navigation-flow':
                            await this.testMobileNavigationFlow(url, deviceType);
                            break;
                        case 'responsive-switching-flow':
                            await this.testResponsiveSwitchingFlow(url, deviceType);
                            break;
                        case 'context-menus-flow':
                            await this.testContextMenusFlow(url);
                            break;
                            
                        // Performance & Advanced Flows
                        case 'memory-leak-flow':
                            await this.testMemoryLeakFlow(url);
                            break;
                        case 'rapid-interaction-flow':
                            await this.testRapidInteractionFlow(url);
                            break;
                        case 'console-errors':
                            await this.testConsoleErrors(url);
                            break;
                        case 'loading-performance':
                            await this.testLoadingPerformance(url);
                            break;
                        default:
                            await this.testGeneric(scenario, url);
                    }

                    this.updateScenarioStatus(scenario.id, 'passed');
                    this.stats.passed++;
                    this.log('success', `✅ ${scenario.name} passed`);

                } catch (error) {
                    this.updateScenarioStatus(scenario.id, 'failed');
                    this.stats.failed++;
                    this.log('error', `❌ ${scenario.name} failed: ${error.message}`);
                    
                    this.reportBug({
                        type: scenario.name,
                        severity: scenario.critical ? 'critical' : 'medium',
                        message: error.message,
                        scenario: scenario.name,
                        url: url,
                        timestamp: new Date().toISOString()
                    });
                }

                this.stats.testsRun++;
                this.updateStats();
            }

            // Individual test methods for LOOOPZ features
            async testSpotifyConnection(url) {
                // Simulate testing Spotify connection button and authentication flow
                this.simulateElementCheck('connect-btn', 'Spotify connection button');
                
                if (Math.random() < 0.15) { // 15% chance of issue
                    throw new Error('Spotify connection button not responding or authentication flow broken');
                }
            }

            async testSearchFunctionality(url) {
                this.simulateElementCheck('search-input', 'Search input field');
                this.simulateElementCheck('search-results', 'Search results container');
                
                if (Math.random() < 0.2) {
                    throw new Error('Search functionality not working - input not responding or results not displaying');
                }
            }

            async testTrackPlayback(url) {
                this.simulateElementCheck('mini-play-btn', 'Mini player play button');
                
                if (Math.random() < 0.25) {
                    throw new Error('Track playback controls not functioning properly');
                }
            }

            async testLoopCreation(url) {
                this.simulateElementCheck('loop-start-handle', 'Loop start handle');
                this.simulateElementCheck('loop-end-handle', 'Loop end handle');
                this.simulateElementCheck('loop-region', 'Loop region display');
                
                if (Math.random() < 0.3) {
                    throw new Error('Loop creation interface elements missing or not functional');
                }
            }

            async testLoopHandles(url) {
                if (Math.random() < 0.2) {
                    throw new Error('Drag-and-drop loop handles not responding to touch/mouse interactions');
                }
            }

            async testPrecisionTiming(url) {
                if (Math.random() < 0.15) {
                    throw new Error('Millisecond precision timing display not accurate or updating incorrectly');
                }
            }

            async testLoopManagement(url) {
                if (Math.random() < 0.25) {
                    throw new Error('Loop save/edit/delete functionality not working properly');
                }
            }

            async testDJTransitions(url) {
                if (Math.random() < 0.1) {
                    throw new Error('DJ transition engine not loading or beat alignment failing');
                }
            }

            async testAIAnalysis(url) {
                if (Math.random() < 0.12) {
                    throw new Error('Essentia.js AI analysis not initializing or analysis functions failing');
                }
            }

            async testSmartCrossfade(url) {
                if (Math.random() < 0.08) {
                    throw new Error('Smart crossfading engine not calculating optimal transitions');
                }
            }

            async testAudioFeatures(url) {
                if (Math.random() < 0.18) {
                    throw new Error('Audio features analysis not retrieving track characteristics');
                }
            }

            async testPlaylistCreation(url) {
                if (Math.random() < 0.2) {
                    throw new Error('Playlist creation interface not working or save functionality broken');
                }
            }

            async testPlaylistReordering(url) {
                if (Math.random() < 0.25) {
                    throw new Error('Drag-and-drop playlist reordering not functioning on current device');
                }
            }

            async testPlaylistPlayback(url) {
                if (Math.random() < 0.15) {
                    throw new Error('Playlist sequential playback not advancing to next track');
                }
            }

            async testSmartTransitions(url) {
                if (Math.random() < 0.1) {
                    throw new Error('Smart playlist transitions not working between tracks and loops');
                }
            }

            async testMiniPlayer(url) {
                this.simulateElementCheck('mini-player', 'Mini player component');
                this.simulateElementCheck('mini-track-title', 'Mini player track title');
                
                if (Math.random() < 0.2) {
                    throw new Error('Mini player not displaying correctly or missing track information');
                }
            }

            async testMobileNavigation(url, deviceType) {
                if (deviceType === 'mobile') {
                    this.simulateElementCheck('mobile-nav', 'Mobile navigation');
                    if (Math.random() < 0.25) {
                        throw new Error('Mobile navigation not working properly on touch devices');
                    }
                }
            }

            async testResponsiveDesign(url, deviceType) {
                if (Math.random() < 0.2) {
                    throw new Error(`Layout breaking on ${deviceType} viewport - elements overlapping or not responsive`);
                }
            }

            async testContextMenus(url) {
                if (Math.random() < 0.15) {
                    throw new Error('Track context menus (three-dot menus) not appearing or not functional');
                }
            }

            async testTrackPopularity(url) {
                if (Math.random() < 0.1) {
                    throw new Error('Track popularity analysis and trending badges not displaying');
                }
            }

            async testConsoleErrors(url) {
                // Simulate console error detection
                if (Math.random() < 0.35) {
                    const errors = [
                        'TypeError: Cannot read property of undefined in script.js',
                        'ReferenceError: spotifyPlayer is not defined',
                        'Failed to load Essentia.js from CDN',
                        'Spotify Web Playback SDK failed to initialize',
                        'Audio analysis cache memory leak detected'
                    ];
                    const randomError = errors[Math.floor(Math.random() * errors.length)];
                    throw new Error(`Console error detected: ${randomError}`);
                }
            }

            async testMemoryUsage(url) {
                if (Math.random() < 0.12) {
                    throw new Error('Memory usage increasing over time - potential memory leak in audio analysis or loop management');
                }
            }

            async testLoadingPerformance(url) {
                const loadTime = Math.random() * 6000 + 2000; // 2-8 seconds
                if (loadTime > 5000) {
                    throw new Error(`Slow loading performance: ${Math.round(loadTime)}ms - optimize asset loading and JS execution`);
                }
            }

            // User Flow Tests - These test realistic user journeys and state-dependent bugs
            async testPlaylistToSearchFlow(url) {
                // Simulate: Start playlist → Switch to search → Try to play track
                if (Math.random() < 0.3) {
                    throw new Error('User flow broken: Can load and play tracks from playlist, but when switching to search view and trying to play a track from search results, the playback fails or progress bar gets stuck while previous playlist music still plays in background');
                }
            }

            async testLibraryToPlaylistFlow(url) {
                // Simulate: Play from library → Switch to playlist → Try to play playlist item
                if (Math.random() < 0.25) {
                    throw new Error('User flow broken: Playing tracks from library works fine, but when switching to playlist view and trying to play a playlist item directly, the track fails to load or playback controls become unresponsive');
                }
            }

            async testTrackSwitchingFlow(url) {
                // Simulate: Play track → Switch to different track while playing
                if (Math.random() < 0.35) {
                    throw new Error('User flow broken: First track load and play works perfectly, but when switching to a different track while music is already playing, the new track starts but progress bar remains stuck at previous position or doesn\'t update correctly');
                }
            }

            async testNavigationStateFlow(url) {
                // Simulate: Navigate between views while track is playing
                if (Math.random() < 0.28) {
                    throw new Error('User flow broken: Music plays correctly, but when navigating between Search → Library → Playlist views while track is playing, the UI state becomes inconsistent - showing wrong track info or outdated playback status across different views');
                }
            }

            async testLoopCreationFlow(url) {
                // Simulate: Search track → Play → Create loop → Save
                if (Math.random() < 0.22) {
                    throw new Error('User flow broken: Searching and playing tracks works, but when trying to create a loop (drag handles) and then save it, the loop points reset or the save function fails. The flow from track selection to loop creation is interrupted');
                }
            }

            async testProgressBarStates(url) {
                // Test progress bar consistency across different contexts
                if (Math.random() < 0.32) {
                    throw new Error('Progress bar state issue: Progress bar updates correctly for the first track played, but after switching between different tracks or views, it shows incorrect timing, gets stuck at previous position, or updates at wrong intervals while music continues playing');
                }
            }

            async testPlayerStateSync(url) {
                // Test player state synchronization across views
                if (Math.random() < 0.27) {
                    throw new Error('Player state sync issue: Play/pause state, track info, or playback position is not synchronized correctly across different views. Mini player shows different info than main player, or play button state is incorrect after view switches');
                }
            }

            async testPlaybackInterruption(url) {
                // Test interrupting playback with new actions
                if (Math.random() < 0.3) {
                    throw new Error('Playback interruption issue: When a track is playing and user starts a new action (search new track, select playlist item, create loop), the interruption handling fails - either both tracks play simultaneously, or new track doesn\'t start, or controls become unresponsive');
                }
            }

            async testContextSwitching(url) {
                // Test switching between search/library/playlist contexts
                if (Math.random() < 0.24) {
                    throw new Error('Context switching issue: App behavior changes unexpectedly when switching between Search, Library, and Playlist contexts. Features that work in one context fail in another, or context-specific data gets mixed up between views');
                }
            }

            async testRapidNavigationFlow(url) {
                // Test rapid clicking between views
                if (Math.random() < 0.18) {
                    throw new Error('Rapid navigation issue: When user rapidly clicks between different navigation items (Search → Library → Playlist → Search), the app state becomes confused, views don\'t load properly, or previous actions interfere with new ones');
                }
            }

            async testMultiTrackQueueFlow(url) {
                // Test playing multiple tracks in sequence
                if (Math.random() < 0.2) {
                    throw new Error('Multi-track queue issue: Playing single tracks works fine, but when trying to queue multiple tracks or play them in sequence, the queue management fails, tracks don\'t advance properly, or playback gets stuck between tracks');
                }
            }

            async testLoopWhileSwitchingFlow(url) {
                // Test creating loops while switching tracks
                if (Math.random() < 0.15) {
                    throw new Error('Loop creation during track switching issue: When user starts creating a loop on one track but then switches to a different track before finishing, the loop creation state becomes corrupted, handles remain visible on wrong track, or loop points get applied to wrong song');
                }
            }

            async testPlaylistCreationFlow(url) {
                // Test complete playlist creation workflow
                if (Math.random() < 0.25) {
                    throw new Error('Playlist creation flow issue: Individual steps work (create playlist, add tracks, save), but the complete user flow from creating new playlist → adding multiple tracks → playing the playlist has issues. Tracks don\'t save properly or playlist playback fails after creation');
                }
            }

            async testPlaylistReorderingFlow(url) {
                // Test reordering playlist then playing
                if (Math.random() < 0.22) {
                    throw new Error('Playlist reordering flow issue: Playlist reordering (drag and drop) works visually, but when playing the reordered playlist, tracks play in old order, or reordering changes don\'t persist, or playback starts from wrong position after reordering');
                }
            }

            async testPlaylistInterruptionFlow(url) {
                // Test interrupting playlist with search actions
                if (Math.random() < 0.28) {
                    throw new Error('Playlist interruption flow issue: Playlist plays correctly, but when user interrupts playlist playback by searching and playing a different track, returning to playlist doesn\'t resume correctly, or playlist state is lost, or both playlist and search track play simultaneously');
                }
            }

            async testMiniPlayerFlow(url) {
                // Test mini player state across different views
                if (Math.random() < 0.26) {
                    throw new Error('Mini player flow issue: Mini player displays correctly in one view, but when navigating to different views, mini player shows outdated information, doesn\'t update with current track, or controls don\'t match actual playback state');
                }
            }

            async testMobileNavigationFlow(url, deviceType) {
                if (deviceType === 'mobile') {
                    if (Math.random() < 0.23) {
                        throw new Error('Mobile navigation flow issue: Touch navigation works for basic actions, but complex user flows (search → play → create loop → switch to playlist) break on mobile. Touch events interfere with each other or gestures don\'t work properly in sequence');
                    }
                }
            }

            async testResponsiveSwitchingFlow(url, deviceType) {
                // Test device rotation or viewport changes during use
                if (Math.random() < 0.17) {
                    throw new Error('Responsive switching flow issue: App works fine on one device size, but when user rotates device or resizes window during use (especially while music is playing or loops are being created), layout breaks, controls become unresponsive, or user data is lost');
                }
            }

            async testContextMenusFlow(url) {
                // Test context menu actions and their effects
                if (Math.random() < 0.19) {
                    throw new Error('Context menu flow issue: Context menus (three-dot menus) appear correctly, but after using context menu actions (add to playlist, create loop, etc.), the resulting action doesn\'t work properly or interferes with current playback state');
                }
            }

            async testMemoryLeakFlow(url) {
                // Test extended usage scenarios
                if (Math.random() < 0.12) {
                    throw new Error('Memory leak flow issue: App works fine for short sessions, but during extended use (multiple track switches, loop creations, playlist management), memory usage increases continuously. Performance degrades over time, indicating memory leaks in user flow management');
                }
            }

            async testRapidInteractionFlow(url) {
                // Test rapid user interactions
                if (Math.random() < 0.16) {
                    throw new Error('Rapid interaction flow issue: Individual actions work fine when done slowly, but when user performs rapid interactions (quick search, fast track switching, rapid loop creation), the app becomes unresponsive, actions queue up incorrectly, or state management fails');
                }
            }

            async testMobileSpecific() {
                this.log('info', '📱 Running mobile-specific test suite...');
                this.updateStatus('running', 'Testing mobile experience...');
                
                const mobileScenarios = this.testScenarios.filter(s => s.category === 'mobile');
                const url = document.getElementById('targetUrl').value;
                
                for (const scenario of mobileScenarios) {
                    await this.runTestScenario(scenario, url, 'mobile');
                    await this.delay(500);
                }
                
                this.updateStatus('success', 'Mobile testing complete');
                this.showToast('Mobile testing complete!', 'success');
            }

            simulateElementCheck(elementId, elementName) {
                // Simulate checking if element exists and is functional
                if (Math.random() < 0.05) { // 5% chance of missing element
                    throw new Error(`${elementName} (id="${elementId}") not found or not functional`);
                }
            }

            reportBug(bugData) {
                const bug = {
                    id: Date.now(),
                    ...bugData,
                    claudeCommand: this.generateClaudeCommand(bugData)
                };
                
                this.bugReports.push(bug);
                this.stats.issuesFound++;
                
                if (bug.claudeCommand) {
                    this.claudeCommands.push({
                        id: bug.id,
                        title: `${bug.type}: ${bug.message}`,
                        severity: bug.severity,
                        command: bug.claudeCommand
                    });
                }
                
                this.updateClaudeCommands();
                this.updateStats();
            }

            generateClaudeCommand(bugData) {
                const descriptions = {
                    // User Flow Issues
                    'Playlist → Search → Play Flow': `User flow issue detected: Users can load and play tracks from playlist successfully, but when they switch to search view and try to play a track from search results, the playback fails or progress bar gets stuck while previous playlist music still plays in background. Please investigate the track loading state management between different views and ensure proper cleanup when switching from playlist to search context.`,

                    'Library → Playlist → Play Flow': `User flow issue detected: Playing tracks from library works fine, but when users switch to playlist view and try to play a playlist item directly, the track fails to load or playback controls become unresponsive. Please check the context switching between library and playlist modes and ensure player state is properly managed across these different contexts.`,

                    'Track Switching While Playing': `User flow issue detected: First track load and play works perfectly, but when switching to a different track while music is already playing, the new track starts but progress bar remains stuck at previous position or doesn't update correctly. Please investigate the track transition logic and ensure progress bar state is properly reset when switching tracks.`,

                    'Navigation State Management': `User flow issue detected: Music plays correctly, but when navigating between Search → Library → Playlist views while track is playing, the UI state becomes inconsistent - showing wrong track info or outdated playback status across different views. Please check the state synchronization between different navigation views and ensure consistent UI updates.`,

                    'Search → Play → Loop → Save Flow': `User flow issue detected: Searching and playing tracks works, but when trying to create a loop (drag handles) and then save it, the loop points reset or the save function fails. The complete user flow from track selection to loop creation is interrupted. Please investigate the loop creation workflow and ensure state persistence throughout the entire process.`,

                    // State-Dependent Issues
                    'Progress Bar State Consistency': `Progress bar state issue: Progress bar updates correctly for the first track played, but after switching between different tracks or views, it shows incorrect timing, gets stuck at previous position, or updates at wrong intervals while music continues playing. Please investigate progress bar update logic and ensure it properly syncs with actual playback position across different contexts.`,

                    'Player State Sync Across Views': `Player state sync issue: Play/pause state, track info, or playback position is not synchronized correctly across different views. Mini player shows different info than main player, or play button state is incorrect after view switches. Please check the global player state management and ensure all UI components stay synchronized.`,

                    'Playback Interruption Handling': `Playback interruption issue: When a track is playing and user starts a new action (search new track, select playlist item, create loop), the interruption handling fails - either both tracks play simultaneously, or new track doesn't start, or controls become unresponsive. Please implement proper playback interruption and cleanup logic.`,

                    'Context Switching (Search/Library/Playlist)': `Context switching issue: App behavior changes unexpectedly when switching between Search, Library, and Playlist contexts. Features that work in one context fail in another, or context-specific data gets mixed up between views. Please ensure consistent behavior across all contexts and proper context isolation.`,

                    // Music Discovery & Switching Flows
                    'Search → Loop → New Search Interrupt': `Search loop interrupt flow issue: User searches track → plays → starts creating loop → immediately searches for new song while loop creation is active. The loop creation state interferes with new search, or both tracks play simultaneously, or loop handles remain visible on wrong track. Please investigate loop creation state management during search interruptions.`,

                    'Search Track → Library Same Track Flow': `Search to library same track issue: User finds and plays track from search results, then navigates to library and tries to play the same track from library. Track doesn't load, shows as duplicate, or playback state becomes confused between search and library contexts. Please ensure consistent track handling across different source contexts.`,

                    'Playlist → Rapid Skip → Loop Creation': `Playlist rapid skip flow issue: User starts playlist, then rapidly skips through multiple tracks using next/previous buttons, then tries to create loop on random track. Rapid skipping breaks track loading, or loop creation fails due to unstable track state. Please investigate track stability during rapid navigation.`,

                    'Track End → User Interaction Flow': `Track completion interaction issue: Track plays completely to the end, then user tries to interact (create loop, replay, switch tracks). Interface becomes unresponsive, progress bar stuck at 100%, or user actions fail on completed track. Please handle end-of-track state and user interactions properly.`,

                    // Loop Creation Edge Cases  
                    'Multiple Loops on Same Track': `Multiple loops same track issue: User creates multiple loops on the same track in sequence (loop 1 → save → loop 2 → save → loop 3). Loop points interfere with each other, previous loops get overwritten, or loop handles show incorrect positions for subsequent loops. Please ensure proper loop isolation and management for multiple loops on one track.`,

                    'Interrupted Loop Creation Flow': `Interrupted loop creation issue: User starts creating loop (drags start handle), gets distracted by notification/call/other app, then returns later to finish loop creation. Loop creation state is lost, handles in wrong position, or app doesn't remember partial loop progress. Please implement proper loop creation state persistence.`,

                    'Loop Save → Immediate Edit Flow': `Loop save immediate edit issue: User creates loop → saves it → immediately tries to edit the same loop while track is still playing. Edit mode conflicts with current playback, loop points don't load correctly for editing, or changes don't save properly. Please handle the transition between loop creation, saving, and editing modes.`,

                    'Loop Creation at Track Boundaries': `Loop at track boundaries issue: User tries to create loop at very beginning (0-5 seconds) or very end of track, or creates loop longer than track duration. Loop creation fails, handles snap to wrong positions, or playback becomes erratic at track boundaries. Please implement proper boundary checking for loop creation.`,

                    'Identical Start/End Loop Points': `Identical loop points issue: User accidentally creates loop with identical start/end points, or creates very short loop (under 2 seconds). App crashes, creates infinite loop, or playback becomes stuck due to zero-duration or micro-duration loops. Please add validation for minimum loop duration and identical points.`,

                    // State Management Edge Cases
                    'Loop → Library → Playlist Flow': `Loop library playlist flow issue: User creates loop → saves to library → immediately adds that saved loop to playlist → tries to play from playlist. Loop metadata gets corrupted between contexts, playlist item doesn't play correctly, or loop points are lost in transition. Please ensure loop data integrity across different storage contexts.`,

                    'Spotify Disconnect → Reconnect Flow': `Spotify reconnection flow issue: User is connected and has track loaded → Spotify connection drops → user reconnects while track was loaded. Previous track state is lost, playback position resets, loop points disappear, or app shows wrong connection status. Please implement proper state recovery after reconnection.`,

                    'Pause → Switch → Resume Flow': `Pause switch resume flow issue: User plays track → pauses → switches to different track → tries to resume paused track. Resume function fails, wrong track resumes, or playback controls become unresponsive after track switching. Please handle pause state persistence across track changes.`,

                    'Share Link → New Tab Flow': `Share link new tab flow issue: User creates loop → generates share link → opens link in new tab while original tab still has music playing. Multiple instances conflict, both tabs try to control Spotify, or loop data doesn't transfer correctly to new tab. Please handle multiple tab scenarios and Spotify connection conflicts.`,

                    // Mobile/Device Scenarios
                    'Screen Rotation During Loop Creation': `Screen rotation loop creation issue: User starts creating loop on mobile → rotates screen mid-creation → tries to finish loop creation. UI layout breaks, loop handles disappear or move to wrong positions, or touch interactions stop working after rotation. Please ensure loop creation state persists through orientation changes.`,

                    'Bluetooth Connect During Playback': `Bluetooth connection flow issue: Music is playing through device speakers → user connects Bluetooth headphones mid-playback. Audio switches but app loses sync, playback controls become unresponsive, or track position gets confused during audio device transition. Please handle audio device changes gracefully.`,

                    'Browser Minimize → Return Flow': `Browser minimize return flow issue: User is using app actively → minimizes browser/switches to other app → returns after several minutes. App state is stale, Spotify connection dropped, UI shows outdated information, or user interactions don't work until page refresh. Please implement proper app focus/blur handling.`,

                    'Phone Call Interrupt → Return Flow': `Phone call interrupt flow issue: User is creating loop or managing playlist → receives phone call → returns to app after call. App lost focus during call, loop creation state corrupted, or Spotify connection interrupted by phone audio system. Please handle phone call interruptions and state recovery.`,

                    // Playlist Workflow Edge Cases
                    'Mixed Loops & Tracks Playlist Flow': `Mixed playlist content flow issue: Playlist contains both regular tracks and saved loops mixed together. During playback, loops don't transition properly to regular tracks, or regular tracks don't transition to loops, causing playback interruption or skip failures. Please ensure seamless transitions between different content types in playlists.`,

                    'Duplicate Tracks in Playlist Flow': `Duplicate tracks playlist flow issue: User adds same track multiple times to playlist (different loop points or same track). Playlist shows duplicates incorrectly, playback gets confused between identical tracks, or loop points from one instance affect other instances. Please handle duplicate track management in playlists.`,

                    'Long Playlist Performance Flow': `Long playlist performance issue: Playlist with 50+ tracks/loops loads slowly, scrolling becomes laggy, or playback transitions become unreliable. App performance degrades with large playlists, memory usage increases, or UI becomes unresponsive. Please optimize performance for large playlists.`,

                    'Playlist Interrupt → Return Flow': `Playlist interrupt return flow issue: Playlist is playing → user interrupts with search/library action → later tries to return to playlist. Playlist position lost, can't resume from where interrupted, or playlist restarts from beginning instead of continuing. Please implement proper playlist state preservation during interruptions.`,

                    // Advanced Feature Conflicts
                    'DJ Transition → Manual Interrupt': `DJ transition manual interrupt issue: Smart DJ transition is in progress between tracks → user manually selects different track mid-transition. Transition becomes corrupted, multiple tracks play simultaneously, or DJ engine gets stuck in transition state. Please handle manual interruptions of automated DJ transitions.`,

                    'Loop Creation During AI Analysis': `Loop during AI analysis issue: AI analysis is running on track → user tries to create loop before analysis completes. Loop creation conflicts with AI processing, analysis results interfere with loop points, or both processes fail due to resource conflicts. Please coordinate AI analysis and loop creation processes.`,

                    'Loop → DJ Effects → New Loop Flow': `Loop DJ effects loop flow issue: User creates loop → applies DJ effects/transitions → tries to create another loop. Previous loop interferes with new one, DJ effects remain active during new loop creation, or loop points become inaccurate due to effect processing. Please handle multiple loop operations with DJ effects.`,

                    'Rapid Loop Create/Delete Flow': `Rapid loop operations flow issue: User rapidly creates → saves → deletes → creates loops in quick succession. Operations queue up incorrectly, app can't keep up with rapid changes, UI becomes unresponsive, or loop data gets corrupted from rapid state changes. Please implement proper rate limiting and operation queuing for loop operations.`,

                    // Browser/Technical Edge Cases
                    'Multiple LOOOPZ Tabs Flow': `Multiple LOOOPZ tabs flow issue: User opens multiple LOOOPZ tabs → tries to play different tracks in each tab. Spotify connection conflicts between tabs, only one tab can control playback, or tabs interfere with each other's state. Please handle multiple tab scenarios and Spotify connection management.`,

                    'Keyboard + Touch Hybrid Flow': `Keyboard touch hybrid flow issue: User switches between keyboard shortcuts and touch/mouse interactions rapidly. Input methods conflict, keyboard shortcuts stop working after touch interaction, or touch gestures don't work after keyboard use. Please ensure consistent input method handling.`,

                    'Loop Creation While Buffering': `Loop while buffering flow issue: Track is still loading/buffering → user tries to create loop before track fully loads. Loop creation fails silently, handles appear but don't work, or loop points are inaccurate due to incomplete track loading. Please ensure tracks are fully loaded before allowing loop creation.`,

                    'Audio Device Switch Flow': `Audio device switch flow issue: User switches audio output devices (speakers → headphones → Bluetooth) while track is playing or loop is being created. Audio routing changes but app doesn't adapt, volume controls become unresponsive, or loop timing becomes inaccurate. Please handle audio device changes during active use.`,

                    // Existing Core Features
                    'Spotify Premium Connection': `The Spotify connection button (id='connect-btn') is not working properly. Please check the Spotify Web Playback SDK initialization, OAuth flow, and ensure the connection button event listeners are properly attached. Look at the initializeSpotifyPlayer() function and connection handling.`,

                    'Track Search & Results': `The search functionality is not working. Please check the search input event listeners (id='search-input'), search results container (id='search-results'), and ensure the Spotify search API calls are working properly. Review the searchTracks() function and result rendering.`,

                    'Visual Loop Creation': `The loop creation interface has issues. Please check the loop handles (id='loop-start-handle', id='loop-end-handle'), loop region display (id='loop-region'), and ensure drag-and-drop functionality works properly. Review the loop creation and visual update functions.`,

                    'Drag-and-Drop Loop Handles': `The drag-and-drop loop handles are not responding properly. Please check the touch and mouse event listeners for loop handles, ensure the drag functionality works on both desktop and mobile, and verify handle positioning updates correctly. Focus on the handle interaction code.`,

                    'Beat-Aligned DJ Transitions': `The DJ transition engine is not working properly. Please check the audio analysis functions, beat alignment calculations, and ensure the transition engine initializes correctly. Verify the audio features API calls and crossfading logic in the PlaylistTransitionEngine class.`,

                    'AI Audio Analysis (Essentia.js)': `The Essentia.js AI analysis is not working. Please check if Essentia.js is loading properly from CDN, verify the initialization code, and ensure the AI analysis functions are correctly implemented. Look at the initializeEssentia() function and related AI code.`,

                    'Create → Add → Play Playlist Flow': `Playlist creation flow issue: Individual steps work (create playlist, add tracks, save), but the complete user flow from creating new playlist → adding multiple tracks → playing the playlist has issues. Tracks don't save properly or playlist playback fails after creation. Please investigate the complete playlist creation workflow.`,

                    'Playlist Reorder → Play Flow': `Playlist reordering flow issue: Playlist reordering (drag and drop) works visually, but when playing the reordered playlist, tracks play in old order, or reordering changes don't persist, or playback starts from wrong position after reordering. Please check playlist order persistence and playback logic.`,

                    'Mobile Touch Navigation Flow': `Mobile navigation flow issue: Touch navigation works for basic actions, but complex user flows (search → play → create loop → switch to playlist) break on mobile. Touch events interfere with each other or gestures don't work properly in sequence. Please investigate mobile touch event handling in complex workflows.`,

                    'Track Playback Controls': `Track playback controls are not functioning properly. Please check the Spotify player integration, play/pause functionality, and ensure the playback state is properly managed and updated in the UI.`,

                    'Console Errors': `JavaScript console errors are being detected. Please check the browser console, fix any undefined variables, missing function calls, or API errors. Ensure error handling is properly implemented.`,

                    'Loading Performance': `Page loading performance is slow. Please optimize asset loading, reduce JavaScript execution time, and improve the initial page load speed. Check for unnecessary API calls or large file loads.`
                };

                return descriptions[bugData.type] || `There's an issue with ${bugData.type}: ${bugData.message}. Please investigate and fix this issue in the LOOOPZ codebase, focusing on the relevant HTML elements, JavaScript functions, and CSS styles.`;
            }

            updateClaudeCommands() {
                const container = document.getElementById('claudeCommands');
                
                if (this.claudeCommands.length === 0) {
                    container.innerHTML = '<div class="empty-state success">✅ No issues detected! Your LOOOPZ site is working perfectly.</div>';
                    return;
                }

                const commandsHtml = this.claudeCommands.map(cmd => `
                    <div class="bug-report">
                        <div class="bug-severity severity-${cmd.severity}">${cmd.severity}</div>
                        <div class="bug-title">${cmd.title}</div>
                        <div class="claude-commands">
                            <div class="commands-header">
                                <span class="commands-title">💬 Description for Claude Code</span>
                                <button class="copy-btn" onclick="copyCommand('${cmd.id}')">Copy</button>
                            </div>
                            <div class="command-block" id="command-${cmd.id}">${cmd.command}</div>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = commandsHtml;
            }

            updateScenarioStatus(scenarioId, status) {
                const scenario = document.getElementById(`scenario-${scenarioId}`);
                if (scenario) {
                    const statusElement = scenario.querySelector('.scenario-status');
                    statusElement.className = `scenario-status status-${status}`;
                    statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                }
            }

            updateStatus(status, message) {
                const indicator = document.getElementById('statusIndicator');
                const text = document.getElementById('statusText');
                
                indicator.className = `status-dot ${status}`;
                text.textContent = message;
            }

            updateStats() {
                document.getElementById('testsRun').textContent = this.stats.testsRun;
                document.getElementById('issuesFound').textContent = this.stats.issuesFound;
                
                const total = this.stats.passed + this.stats.failed;
                const passRate = total > 0 ? Math.round((this.stats.passed / total) * 100) : 0;
                document.getElementById('passRate').textContent = `${passRate}%`;
                
                const coverage = Math.min(Math.round((this.stats.testsRun / this.testScenarios.length) * 100), 100);
                document.getElementById('coverage').textContent = `${coverage}%`;
            }

            resetStats() {
                this.stats = { testsRun: 0, issuesFound: 0, passed: 0, failed: 0 };
                this.bugReports = [];
                this.claudeCommands = [];
                this.updateStats();
                this.updateClaudeCommands();
                
                // Reset all scenario statuses
                this.testScenarios.forEach(scenario => {
                    this.updateScenarioStatus(scenario.id, 'pending');
                });
            }

            completeTestRun() {
                this.isRunning = false;
                const passRate = this.stats.passed + this.stats.failed > 0 ? 
                    Math.round((this.stats.passed / (this.stats.passed + this.stats.failed)) * 100) : 0;
                
                this.updateStatus('success', `Testing complete - ${passRate}% pass rate`);
                this.log('success', `✅ Advanced testing complete! ${this.stats.issuesFound} issues found.`);
                
                if (this.stats.issuesFound === 0) {
                    this.log('success', '🎉 No issues detected! Your advanced LOOOPZ features are working perfectly.');
                    this.showToast('Perfect score! No issues found 🎉', 'success');
                } else {
                    this.log('warning', `📋 Generated ${this.stats.issuesFound} descriptions for Claude Code.`);
                    this.showToast(`Found ${this.stats.issuesFound} issues with descriptions ready`, 'error');
                }
            }

            stopTesting() {
                this.isRunning = false;
                this.updateStatus('idle', 'Testing stopped');
                this.log('warning', '⏹️ Testing stopped by user');
                this.showToast('Testing stopped', 'error');
            }

            copyAllCommands() {
                const allDescriptions = this.claudeCommands.map(cmd => 
                    `${cmd.title}:\n${cmd.command}\n\n`
                ).join('');
                
                navigator.clipboard.writeText(allDescriptions).then(() => {
                    this.showToast('All descriptions copied to clipboard!', 'success');
                });
            }

            copyLog() {
                const logEntries = document.querySelectorAll('#testLog .log-entry');
                const logText = Array.from(logEntries).map(entry => entry.textContent).join('\n');
                
                navigator.clipboard.writeText(logText).then(() => {
                    this.showToast('Test log copied to clipboard!', 'success');
                });
            }

            log(type, message) {
                const logContainer = document.getElementById('testLog');
                const timestamp = new Date().toLocaleTimeString();
                
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = `toast ${type}`;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 4000);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Global function for copy buttons
        function copyCommand(commandId) {
            const commandText = document.getElementById(`command-${commandId}`).textContent;
            navigator.clipboard.writeText(commandText).then(() => {
                const tester = window.looopzTester;
                if (tester) {
                    tester.showToast('Description copied to clipboard!', 'success');
                }
            });
        }

        // Initialize the advanced testing dashboard
        window.looopzTester = new LOOOPZAdvancedTester();
    </script>
</body>
</html>